{"remainingRequest":"/var/www/html/MidTrade/Capstone/vue/milestone9_titus/node_modules/vue-loader/lib/index.js??vue-loader-options!/var/www/html/MidTrade/Capstone/vue/milestone9_titus/src/components/UploadListingImage.vue?vue&type=script&lang=js&","dependencies":[{"path":"/var/www/html/MidTrade/Capstone/vue/milestone9_titus/src/components/UploadListingImage.vue","mtime":1615755992983},{"path":"/var/www/html/MidTrade/Capstone/vue/milestone9_titus/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/var/www/html/MidTrade/Capstone/vue/milestone9_titus/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/var/www/html/MidTrade/Capstone/vue/milestone9_titus/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/var/www/html/MidTrade/Capstone/vue/milestone9_titus/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBheGlvcyBmcm9tICdheGlvcyc7CmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAnVXBsb2FkTGlzdGluZ0ltYWdlJywKICBwcm9wczogWydsaXN0aW5nJ10sCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGRhdGE6IHRoaXMubGlzdGluZywKICAgICAgZmlsZUlucHV0OiAnJywKICAgICAgdmFsaWRUeXBlczogWyJpbWFnZS9qcGciLCAiaW1hZ2UvanBlZyIsICJpbWFnZS9wbmciXQogICAgfQogIH0sCiAgbWV0aG9kczogewogICAgY2hlY2tBbmRTdWJtaXQ6IGZ1bmN0aW9uKCkgewogICAgICBpZih0aGlzLnZhbGlkVHlwZXMuaW5jbHVkZXModGhpcy5maWxlSW5wdXQudHlwZSkpIHsKICAgICAgICBjb25zb2xlLmxvZygiU3VjY2Vzc2Z1bCB1cGxvYWQiKQogICAgICB9IGVsc2UgewogICAgICAgIGFsZXJ0KCdZb3UgYXR0ZW1wdGVkIHRvIHVwbG9hZCBhbiBpbWFnZSBmaWxlIHdpdGggYW4gaW52YWxpZCB0eXBlLiBDbGVhciB0aGUgZmllbGQgYW5kIHRyeSB1cGxvYWRpbmcgYSBQTkcsIEpQRywgb3IgSlBFRycpCiAgICAgIH0KCiAgICAgIC8vIE5vdyBjaGVjayB0aGUgbnVtYmVyIG9mIGltYWdlcyByZWxhdGVkIHRvIHRoaXMgbGlzdGluZy4KICAgICAgYXhpb3MuZ2V0KCJodHRwOi8vbWlkbi5jcy51c25hLmVkdS9NaWRUcmFkZS9DYXBzdG9uZS92dWUvbWlsZXN0b25lOV90aXR1cy9zcmMvZGIvZ2V0SW1hZ2VDb3VudEJ5TGlzdGluZy5waHA/aWQ9IiArIHRoaXMubGlzdGluZy5saXN0aW5nSUQpCiAgICAgIC50aGVuKHJlc3VsdCA9PiB7CiAgICAgICAgIGxldCBpbWFnZXNJbkRCID0gcmVzdWx0LmRhdGEucGF5bG9hZFswXS5jb3VudAogICAgICAgICAKICAgICAgICAgaWYoaW1hZ2VzSW5EQiA9PSAzKSB7CiAgICAgICAgICAgYWxlcnQoJ1lvdSBtYXkgbm90IGhhdmUgbW9yZSB0aGFuIDMgaW1hZ2VzIGFzc29jaWF0ZWQgd2l0aCB0aGlzIGxpc3RpbmcgYXQgYSB0aW1lJykgCiAgICAgICAgIH0gZWxzZSB7CgogICAgICAgICAgIC8vIElmIEkgbWFkZSBpdCB0aGlzIGZhciwgdGhlbiBJJ20gZ29vZCB0byBpbnNlcnQgYSBuZXcgaW1hZ2UuCiAgICAgICAgICAgY29uc3QgZmQgPSBuZXcgRm9ybURhdGEoKTsKICAgICAgICAgICBmZC5hcHBlbmQoJ2ltYWdlJywgdGhpcy5maWxlSW5wdXQsIHRoaXMuZmlsZUlucHV0Lm5hbWUpCiAgICAgICAgICAgZmQuYXBwZW5kKCdsaXN0aW5nSUQnLCB0aGlzLmxpc3RpbmcubGlzdGluZ0lEKQogICAgICAgICAgIGF4aW9zLnBvc3QoImh0dHA6Ly9taWRuLmNzLnVzbmEuZWR1L01pZFRyYWRlL0NhcHN0b25lL3Z1ZS9taWxlc3RvbmU5X3RpdHVzL3NyYy9kYi9oYW5kbGVMaXN0aW5nSW1hZ2UucGhwIiwgZmQpCiAgICAgICAgICAgLnRoZW4ocmVzdWx0ID0+IHsKICAgICAgICAgICAgIGlmKHJlc3VsdCA9PSAiQ291bGQgbm90IHVwbG9hZCBpbWFnZSIpCiAgICAgICAgICAgICAgICBhbGVydChyZXN1bHQpCiAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBhbGVydCgiSW1hZ2Ugc3VjY2Vzc2Z1bGx5IHVwbG9hZGVkIikKICAgICAgICAgICAgIH0pCiAgICAgICAgICAgLmNhdGNoKGUgPT4gewogICAgICAgICAgICAgY29uc29sZS5sb2coZSkKICAgICAgICAgICAgfSkKICAgICAgICAgfQogICAgICB9KQogICAgICAuY2F0Y2goZSA9PiB7CiAgICAgICAgY29uc29sZS5sb2coZSkKICAgICAgfSkgCgogICAgIAogICAgfSAKICB9Cn0K"},{"version":3,"sources":["UploadListingImage.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA","file":"UploadListingImage.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <v-dialog max-width=\"600px\">\n    <template v-slot:activator=\"{on, attrs}\">\n    <v-btn color=\"primary\" text v-bind=\"attrs\" v-on=\"on\">Upload Image</v-btn>\n    </template>\n    <v-card>\n      <v-card-title>\n        <h2>Upload Image For: {{this.listing.productName}}</h2> \n      </v-card-title>\n\n      <v-card-text>\n          <v-form>\n            <v-container>\n              <p>You can upload an image of the product you're selling here. You may only upload one image at a time</p> \n            \n              <v-row>\n                <v-col cols=\"12\">\n                  <v-form>\n                    <v-file-input\n                      v-model=\"fileInput\"\n                      label=\"Click Here to Browse Files\"\n                      counter\n                      :rules=\"['Required']\"\n                    ></v-file-input>\n                  </v-form>\n                </v-col>\n              </v-row>\n            </v-container>\n          </v-form>\n      </v-card-text>\n \n      <v-card-actions>\n        <v-btn\n          color=\"primary\"\n          @click=\"checkAndSubmit()\"  \n        >\n          Upload Image\n        </v-btn>\n      </v-card-actions>\n    </v-card>\n  </v-dialog> \n</template>\n\n<script>\nimport axios from 'axios';\nexport default {\n  name: 'UploadListingImage',\n  props: ['listing'],\n  data() {\n    return {\n      data: this.listing,\n      fileInput: '',\n      validTypes: [\"image/jpg\", \"image/jpeg\", \"image/png\"]\n    }\n  },\n  methods: {\n    checkAndSubmit: function() {\n      if(this.validTypes.includes(this.fileInput.type)) {\n        console.log(\"Successful upload\")\n      } else {\n        alert('You attempted to upload an image file with an invalid type. Clear the field and try uploading a PNG, JPG, or JPEG')\n      }\n\n      // Now check the number of images related to this listing.\n      axios.get(\"http://midn.cs.usna.edu/MidTrade/Capstone/vue/milestone9_titus/src/db/getImageCountByListing.php?id=\" + this.listing.listingID)\n      .then(result => {\n         let imagesInDB = result.data.payload[0].count\n         \n         if(imagesInDB == 3) {\n           alert('You may not have more than 3 images associated with this listing at a time') \n         } else {\n\n           // If I made it this far, then I'm good to insert a new image.\n           const fd = new FormData();\n           fd.append('image', this.fileInput, this.fileInput.name)\n           fd.append('listingID', this.listing.listingID)\n           axios.post(\"http://midn.cs.usna.edu/MidTrade/Capstone/vue/milestone9_titus/src/db/handleListingImage.php\", fd)\n           .then(result => {\n             if(result == \"Could not upload image\")\n                alert(result)\n             else\n                alert(\"Image successfully uploaded\")\n             })\n           .catch(e => {\n             console.log(e)\n            })\n         }\n      })\n      .catch(e => {\n        console.log(e)\n      }) \n\n     \n    } \n  }\n}\n</script>\n\n<style scoped>\n\n</style>\n"]}]}